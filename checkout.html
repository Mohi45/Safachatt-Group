<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout - Jyoti's Cosmetic House</title>
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/navbar.css">
    <link rel="stylesheet" href="css/header.css">
    <link rel="stylesheet" href="css/footer.css">
    <link rel="stylesheet" href="css/checkout.css">
</head>

<body>
    <nav class="navbar">
        <div class="logo">Safachatt Group</div>
        <button class="menu-toggle" aria-label="Toggle menu">â˜°</button>
        <ul class="nav-links">
            <li><a href="index.html#home">Home</a></li>
            <li><a href="index.html#products">Products</a></li>
            <li><a href="index.html#contact">Contact</a></li>
        </ul>
    </nav>

    <div class="checkout-container">
        <h2 class="checkout-title">Checkout Summary</h2>

        <div class="checkout-items"></div>

        <div class="checkout-summary">
            <p><strong>Total Amount:</strong> <span id="totalAmount">â‚¹0</span></p>
            <p style="color: green; font-weight: 600;">ğŸ‰ You saved <span id="totalSaved">â‚¹0</span> on this order!</p>
        </div>

        <div class="upi-section">
            <h3>Pay via UPI</h3>
            <p>UPI ID: <strong>9625290733@ybl</strong></p>
            <img src="img/upi-qr.png" alt="UPI QR Code" style="max-width:160px;">
        </div>

        <label for="checkoutAddress">Enter Delivery Address:</label>
        <textarea id="checkoutAddress" placeholder="Type your full address here" rows="3" required></textarea>

        <div class="action-buttons">
            <button class="btn" id="continueShopping">â† Continue Shopping</button>
            <button class="btn" id="confirmWhatsApp">Place Order via WhatsApp</button>
        </div>
    </div>

    <footer>
        <p style="text-align:center; margin-top:40px; color:#888;">
            Â© 2025 Jyoti's Cosmetic House. All Rights Reserved.
        </p>
    </footer>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const container = document.querySelector(".checkout-items");
            const totalEl = document.getElementById("totalAmount");
            const savedEl = document.getElementById("totalSaved");
            const confirmBtn = document.getElementById("confirmWhatsApp");
            const continueBtn = document.getElementById("continueShopping");

            function renderCart() {
                const cart = JSON.parse(localStorage.getItem("cartData")) || [];
                let total = 0;
                let totalSaved = 0;
                container.innerHTML = "";

                if (cart.length === 0) {
                    container.innerHTML = "<p>No items in cart. Go back and select products.</p>";
                    confirmBtn.disabled = true;
                    totalEl.textContent = "â‚¹0";
                    savedEl.textContent = "â‚¹0";
                    return;
                }

                confirmBtn.disabled = false;

                cart.forEach((item, i) => {
                    const originalPrice = item.price;
                    const discount = item.discount || 0;
                    const discountedPrice = item.discountedPrice
                        ? item.discountedPrice
                        : (originalPrice * (1 - discount / 100)).toFixed(0);
                    const subtotal = discountedPrice * item.qty;
                    const savedAmount = (originalPrice - discountedPrice) * item.qty;

                    total += subtotal;
                    totalSaved += savedAmount;

                    container.innerHTML += `
                <div class="checkout-item">
                    <img src="${item.img}" alt="${item.name}">
                    <div>
                        <h3>${item.name}</h3>
                        <p>Qty: ${item.qty}</p>
                        <p>â‚¹${discountedPrice} <del style="color:gray;">â‚¹${originalPrice}</del> 
                        <span style="color:green;">(${discount}% OFF)</span></p>
                        <p class="save-msg">You save â‚¹${savedAmount.toFixed(0)}!</p>
                    </div>
                    <div class="item-total">â‚¹${subtotal.toFixed(0)}</div>
                </div>
            `;
                });

                totalEl.textContent = `â‚¹${total.toFixed(0)}`;
                savedEl.textContent = `â‚¹${totalSaved.toFixed(0)}`;
            }

            // Initial render
            renderCart();

            // Listen for storage updates (same tab or other tabs)
            window.addEventListener("storage", (event) => {
                if (!event.key || event.key === "cartData") {
                    renderCart();
                }
            });

            continueBtn.addEventListener("click", () => {
                window.location.href = "index.html";
            });

            confirmBtn.addEventListener("click", () => {
                const cart = JSON.parse(localStorage.getItem("cartData")) || [];
                if (cart.length === 0) {
                    alert("Your cart is empty.");
                    return;
                }

                const address = document.getElementById("checkoutAddress").value.trim();
                if (!address) {
                    alert("Please enter your delivery address.");
                    return;
                }

                const total = cart.reduce((sum, item) => {
                    const price = item.discountedPrice ? item.discountedPrice : (item.price * (1 - item.discount / 100)).toFixed(0);
                    return sum + price * item.qty;
                }, 0);

                const totalSaved = cart.reduce((sum, item) => {
                    const price = item.discountedPrice ? item.discountedPrice : (item.price * (1 - item.discount / 100)).toFixed(0);
                    return sum + (item.price - price) * item.qty;
                }, 0);

                const orderId = "JCH" + Math.floor(Math.random() * 90000 + 10000);
                const phoneNumber = "919625290733";

                let message = `ğŸ›ï¸ *New Order Received!*%0A%0AğŸ†” *Order ID:* ${orderId}%0A%0Aâœ¨ *Order Summary:*%0A`;

                cart.forEach((item, i) => {
                    const price = item.discountedPrice ? item.discountedPrice : (item.price * (1 - item.discount / 100)).toFixed(0);
                    const saved = ((item.price - price) * item.qty).toFixed(0);
                    const emojis = ["ğŸ§´", "ğŸ’…", "ğŸŒ¸", "ğŸ«§", "ğŸª", "ğŸ§¼", "ğŸ’–"];
                    const emoji = emojis[i % emojis.length];
                    const line = `${emoji} *${item.name}*%0A   â€¢ Qty: ${item.qty} Ã— â‚¹${price}%0A   â€¢ You saved â‚¹${saved}%0A`;
                    message += encodeURIComponent(line + "%0A");
                });

                const footer = `
ğŸ’° *Total:* â‚¹${total.toFixed(0)}
ğŸ‰ *You Saved:* â‚¹${totalSaved.toFixed(0)}

ğŸ“ *Delivery Address:* ${address}

ğŸ’³ *Payment via UPI:* 9625290733@ybl
ğŸ“¸ *Please share the payment screenshot as well.*

Thank you for shopping with *Jyotiâ€™s Cosmetic House!* ğŸ’–ğŸŒ·
        `;
                message += encodeURIComponent(footer);

                window.open(`https://wa.me/${phoneNumber}?text=${message}`, "_blank");
            });
        });
    </script>

</body>

</html>